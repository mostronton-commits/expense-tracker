<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–∫–µ—Ä –¥–æ—Ö–æ–¥—ñ–≤ —ñ –≤–∏—Ç—Ä–∞—Ç</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg-primary: #f5f5f7;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f9f9fb;
            --text-primary: #1d1d1f;
            --text-secondary: #6e6e73;
            --border-color: #d2d2d7;
            --shadow: rgba(0, 0, 0, 0.08);
            --hover-bg: #f9f9fb;
        }

        [data-theme="dark"] {
            --bg-primary: #1d1d1f;
            --bg-secondary: #2d2d2f;
            --bg-tertiary: #3d3d3f;
            --text-primary: #f5f5f7;
            --text-secondary: #a1a1a6;
            --border-color: #48484a;
            --shadow: rgba(0, 0, 0, 0.3);
            --hover-bg: #3d3d3f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 20px;
            transition: background 0.3s, color 0.3s;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
        }

        .container {
            width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        @media (max-width: 1240px) {
            .container {
                width: 100%;
                padding: 0 20px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
            color: var(--text-primary);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 24px;
                margin-bottom: 20px;
            }
        }

        .card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow);
            position: relative;
        }

        @media (max-width: 768px) {
            .card {
                padding: 16px;
                margin-bottom: 16px;
            }
        }

        /* Dark Mode Toggle */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 8px var(--shadow);
            transition: all 0.3s;
            font-size: 24px;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .theme-toggle {
                width: 44px;
                height: 44px;
                font-size: 20px;
                top: 10px;
                right: 10px;
            }
        }

        .top-right-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            justify-content: flex-end;
        }

        .top-right-buttons button {
            font-size: 13px;
            padding: 8px 14px;
            opacity: 0.8;
        }

        .top-right-buttons button:hover {
            opacity: 1;
        }

        /* –ü—Ä–∏–±–∏—Ä–∞—î–º–æ —Å—Ç–∞—Ä–∏–π –≤—ñ–¥—Å—Ç—É–ø –¥–ª—è —Ñ–æ—Ä–º–∏ */
        #transactionForm {
            /* padding-right –≤–∏–¥–∞–ª–µ–Ω–æ */
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 30px;
            background: var(--bg-secondary);
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        @media (max-width: 768px) {
            .nav-tabs {
                margin-bottom: 20px;
                padding: 8px;
                gap: 8px;
            }
        }

        .nav-tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        @media (max-width: 768px) {
            .nav-tab {
                padding: 10px 16px;
                font-size: 14px;
            }
        }

        .nav-tab:hover {
            background: var(--hover-bg);
        }

        .nav-tab.active {
            background: #0071e3;
            color: white;
        }

        .form-row {
            display: grid;
            grid-template-columns: auto auto auto auto 2fr auto;
            gap: 12px;
            margin-bottom: 16px;
            align-items: end;
        }

        @media (max-width: 1024px) {
            .form-row {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        input, select, button {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        @media (max-width: 768px) {
            input, select, button {
                padding: 12px;
                font-size: 16px; /* Prevent zoom on iOS */
            }
        }

        input:focus, select:focus {
            outline: none;
            border-color: #0071e3;
        }

        button {
            background: #0071e3;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            button {
                width: 100%;
            }
        }

        button:hover {
            background: #0077ed;
        }

        button:disabled {
            background: var(--border-color);
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--hover-bg);
        }

        .month-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .month-nav button {
            padding: 8px 16px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .month-nav button:hover {
            background: var(--hover-bg);
        }

        .month-title {
            font-size: 20px;
            font-weight: 600;
            min-width: 200px;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            table {
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            table thead {
                display: none;
            }
            
            table tr {
                display: block;
                margin-bottom: 12px;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                padding: 12px;
            }
            
            table td {
                display: block;
                text-align: left;
                padding: 4px 0 !important;
                border: none !important;
            }
            
            table td:before {
                content: attr(data-label);
                font-weight: 600;
                margin-right: 8px;
                color: var(--text-secondary);
            }
            
            .row-actions {
                position: static !important;
                opacity: 1 !important;
                margin-top: 8px;
            }
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        tr {
            position: relative;
            transition: all 0.2s ease;
            color: var(--text-primary);
        }

        tr:hover {
            background: var(--hover-bg);
            box-shadow: 0 2px 8px var(--shadow);
            transform: translateY(-1px);
        }

        @media (max-width: 768px) {
            tr:hover {
                transform: none;
            }
        }

        /* –Ü–∫–æ–Ω–∫–∏ –¥—ñ–π - –∑'—è–≤–ª—è—é—Ç—å—Å—è —Å–ø—Ä–∞–≤–∞ –ø—Ä–∏ hover */
        .row-actions {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s;
            background: var(--bg-secondary);
            padding: 4px 8px;
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        tr:hover .row-actions {
            opacity: 1;
        }

        td {
            color: var(--text-primary);
        }

        tr::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            border-radius: 2px 0 0 2px;
        }

        tr.income::before {
            background: #34c759;
        }

        tr.expense::before {
            background: #ff9500;
        }

        tr.exchange::before {
            background: #8e8e93;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            color: #6e6e73;
            font-size: 16px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .icon-btn:hover {
            color: #1d1d1f;
            transform: scale(1.1);
        }

        .icon-btn.delete:hover {
            color: #ff3b30;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 13px;
            margin-right: 8px;
        }

        .btn-delete {
            background: #ff3b30;
        }

        .btn-delete:hover {
            background: #ff453a;
        }

        .summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .summary {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        .summary-item {
            padding: 24px;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            text-align: center;
        }

        @media (max-width: 768px) {
            .summary-item {
                padding: 20px;
            }
        }

        .summary-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px var(--shadow);
        }

        @media (max-width: 768px) {
            .summary-item:hover {
                transform: translateY(-2px);
            }
        }

        .summary-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 8px;
        }

        .summary-value {
            font-size: 28px;
            font-weight: 600;
            margin-top: 8px;
            color: var(--text-primary);
        }

        @media (max-width: 768px) {
            .summary-value {
                font-size: 24px;
            }
        }

        .summary-value.income { color: #34c759; }
        .summary-value.expense { color: #ff9500; }

        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            background-color: #1d1d1f;
            color: white;
            text-align: center;
            padding: 8px 12px;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 13px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .forecast-section {
            background: var(--bg-tertiary);
            border: 2px dashed #ff9500;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .forecast-title {
            font-size: 18px;
            font-weight: 600;
            color: #ff9500;
            margin-bottom: 16px;
        }

        .forecast-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid var(--border-color);
        }

        .forecast-item span {
            color: var(--text-primary);
        }
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .stat-comparison {
            font-size: 14px;
        }

        .stat-comparison.positive {
            color: #34c759;
        }

        .stat-comparison.negative {
            color: #ff3b30;
        }

        .chart-container {
            background: var(--bg-secondary);
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid var(--border-color);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 20px;
            height: 300px;
            padding: 20px 0;
        }

        .bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .bars {
            display: flex;
            gap: 4px;
            width: 100%;
            align-items: flex-end;
            height: 250px;
        }

        .bar {
            flex: 1;
            border-radius: 4px 4px 0 0;
            min-height: 2px;
            position: relative;
            transition: all 0.3s;
        }

        .bar:hover {
            opacity: 0.8;
        }

        .bar.income-bar {
            background: #34c759;
        }

        .bar.expense-bar {
            background: #ff9500;
        }

        .bar-label {
            font-size: 12px;
            color: #6e6e73;
            text-align: center;
        }

        .bar-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
        }

        .hidden {
            display: none;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            max-width: 400px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-left: 4px solid #34c759;
        }

        .toast.error {
            border-left: 4px solid #ff3b30;
        }

        .toast-icon {
            font-size: 24px;
        }

        .toast-message {
            flex: 1;
            font-size: 15px;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #6e6e73;
            padding: 0;
            width: 24px;
            height: 24px;
        }

        /* Loading States */
        button.loading {
            position: relative;
            color: transparent;
            pointer-events: none;
        }

        button.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid transparent;
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* –ü–æ–∫—Ä–∞—â–µ–Ω—ñ summary cards –∑ trends */
        /* Smooth scroll animation */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        tr.new-transaction {
            animation: slideIn 0.5s ease;
        }

        tr.new-transaction td {
            background: #d1f4e0;
        }

        /* Auth Styles */
        .auth-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: var(--bg-secondary);
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow);
            border: 1px solid var(--border-color);
        }

        @media (max-width: 768px) {
            .auth-container {
                margin: 50px auto;
                padding: 30px 20px;
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-header h2 {
            font-size: 28px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .auth-header p {
            font-size: 15px;
            color: var(--text-secondary);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .auth-form input {
            width: 100%;
            padding: 12px 16px;
            font-size: 16px;
        }

        .auth-form button {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            margin-top: 8px;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 24px 0;
            color: var(--text-secondary);
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--border-color);
        }

        .auth-divider span {
            padding: 0 16px;
            font-size: 14px;
        }

        .social-login {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .social-btn {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .social-btn:hover {
            background: var(--hover-bg);
            border-color: #0071e3;
        }

        .auth-footer {
            text-align: center;
            margin-top: 24px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .auth-footer a {
            color: #0071e3;
            text-decoration: none;
            cursor: pointer;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        .error-message {
            background: #ffe5e5;
            color: #d93025;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
            border: 1px solid #ff3b30;
        }

        [data-theme="dark"] .error-message {
            background: #3d1d1d;
            border-color: #ff3b30;
        }

        .success-message {
            background: #d1f4e0;
            color: #0d894f;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
            border: 1px solid #34c759;
        }

        [data-theme="dark"] .success-message {
            background: #1d3d2d;
            border-color: #34c759;
        }

        /* Dropdown Menu Styles */
        .user-menu {
            position: fixed;
            top: 20px;
            right: 80px;
            z-index: 1000;
            background: var(--bg-secondary);
            padding: 10px 16px;
            border-radius: 24px;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid var(--border-color);
        }

        @media (max-width: 768px) {
            .user-menu {
                top: 10px;
                right: 60px;
                padding: 8px 12px;
            }
        }

        .user-menu-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            user-select: none;
        }

        .user-email {
            font-size: 14px;
            color: var(--text-primary);
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        @media (max-width: 768px) {
            .user-email {
                max-width: 100px;
                font-size: 12px;
            }
        }

        .dropdown-arrow {
            font-size: 10px;
            color: var(--text-secondary);
            transition: transform 0.2s;
        }

        .user-menu.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .user-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 8px 24px var(--shadow);
            min-width: 200px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s;
            z-index: 1001;
        }

        .user-menu.active .user-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        .dropdown-item:first-child {
            border-radius: 12px 12px 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 12px 12px;
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--hover-bg);
        }

        .dropdown-item.danger {
            color: #ff3b30;
        }

        .dropdown-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .theme-switch-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .theme-switch {
            position: relative;
            width: 40px;
            height: 22px;
            background: var(--border-color);
            border-radius: 11px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .theme-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        [data-theme="dark"] .theme-switch {
            background: #667eea;
        }

        [data-theme="dark"] .theme-switch::after {
            transform: translateX(18px);
        }
    </style>
</head>
<body>
    <div id="authContainer" class="auth-container">
        <!-- Login Form -->
        <div id="loginForm">
            <div class="auth-header">
                <h2 style="font-size: 42px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 8px;">MONI</h2>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 16px;">–†–æ–∑—É–º–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ñ—ñ–Ω–∞–Ω—Å–∞–º–∏</p>
                <p>–£–≤—ñ–π–¥—ñ—Ç—å —â–æ–± –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</p>
            </div>

            <div id="authError" class="error-message" style="display: none;"></div>
            <div id="authSuccess" class="success-message" style="display: none;"></div>

            <div class="social-login">
                <button class="social-btn" onclick="loginWithGoogle()">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
                    Google
                </button>
            </div>

            <div class="auth-divider">
                <span>–∞–±–æ</span>
            </div>

            <form class="auth-form" onsubmit="handleLogin(event)">
                <input 
                    type="email" 
                    id="loginEmail" 
                    placeholder="Email" 
                    required
                    autocomplete="email"
                >
                <input 
                    type="password" 
                    id="loginPassword" 
                    placeholder="–ü–∞—Ä–æ–ª—å" 
                    required
                    autocomplete="current-password"
                >
                <button type="submit">–£–≤—ñ–π—Ç–∏</button>
            </form>

            <div class="auth-footer">
                –ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É? <a onclick="showSignup()">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</a><br>
                <a onclick="showForgotPassword()" style="font-size: 13px;">–ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
            </div>
        </div>

        <!-- Signup Form -->
        <div id="signupForm" style="display: none;">
            <div class="auth-header">
                <h2 style="font-size: 42px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 8px;">MONI</h2>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 16px;">–†–æ–∑—É–º–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ñ—ñ–Ω–∞–Ω—Å–∞–º–∏</p>
                <p>–°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å</p>
            </div>

            <div id="signupError" class="error-message" style="display: none;"></div>
            <div id="signupSuccess" class="success-message" style="display: none;"></div>

            <div class="social-login">
                <button class="social-btn" onclick="loginWithGoogle()">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
                    Google
                </button>
            </div>

            <div class="auth-divider">
                <span>–∞–±–æ</span>
            </div>

            <form class="auth-form" onsubmit="handleSignup(event)">
                <input 
                    type="email" 
                    id="signupEmail" 
                    placeholder="Email" 
                    required
                    autocomplete="email"
                >
                <input 
                    type="password" 
                    id="signupPassword" 
                    placeholder="–ü–∞—Ä–æ–ª—å (–º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤)" 
                    required
                    minlength="6"
                    autocomplete="new-password"
                >
                <button type="submit">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å</button>
            </form>

            <div class="auth-footer">
                –í–∂–µ —î –∞–∫–∞—É–Ω—Ç? <a onclick="showLogin()">–£–≤—ñ–π—Ç–∏</a>
            </div>
        </div>

        <!-- Forgot Password Form -->
        <div id="forgotPasswordForm" style="display: none;">
            <div class="auth-header">
                <h2 style="font-size: 42px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 8px;">MONI</h2>
                <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 16px;">–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—é</p>
                <p>–í–≤–µ–¥—ñ—Ç—å email –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è</p>
            </div>

            <div id="forgotError" class="error-message" style="display: none;"></div>
            <div id="forgotSuccess" class="success-message" style="display: none;"></div>

            <form class="auth-form" onsubmit="handleForgotPassword(event)">
                <input 
                    type="email" 
                    id="forgotEmail" 
                    placeholder="Email" 
                    required
                    autocomplete="email"
                >
                <button type="submit">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</button>
            </form>

            <div class="auth-footer">
                <a onclick="showLogin()">‚Üê –ù–∞–∑–∞–¥ –¥–æ –≤—Ö–æ–¥—É</a>
            </div>
        </div>
    </div>

    <!-- Main App (hidden until logged in) -->
    <div id="appContainer" style="display: none;">
        <!-- User Menu -->
        <div class="user-menu" id="userMenu">
            <div class="user-menu-toggle" onclick="toggleUserMenu()">
                <span class="user-email" id="userEmail"></span>
                <span class="dropdown-arrow">‚ñº</span>
            </div>
            <div class="user-dropdown">
                <div class="dropdown-item" onclick="toggleThemeFromDropdown()">
                    <span class="dropdown-icon">üåô</span>
                    <div class="theme-switch-wrapper">
                        <span id="darkThemeLabel">–¢–µ–º–Ω–∞ —Ç–µ–º–∞</span>
                        <div class="theme-switch" id="themeSwitch"></div>
                    </div>
                </div>
                <div class="dropdown-item">
                    <span class="dropdown-icon">üåê</span>
                    <div class="theme-switch-wrapper">
                        <span id="languageLabel">–ú–æ–≤–∞</span>
                        <select id="languageSelect" onchange="changeLanguage(this.value)" style="background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); border-radius: 6px; padding: 4px 8px; cursor: pointer;">
                            <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
                <div class="dropdown-item" onclick="exportCSV()">
                    <span class="dropdown-icon">üìä</span>
                    <span id="exportCSVLabel">–ï–∫—Å–ø–æ—Ä—Ç CSV</span>
                </div>
                <div class="dropdown-item danger" onclick="handleLogout()">
                    <span class="dropdown-icon">üö™</span>
                    <span id="logoutLabel">–í–∏—Ö—ñ–¥</span>
                </div>
            </div>
        </div>

        <!-- Dark Mode Toggle -->
        <h1 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; font-size: 36px; font-weight: 700;">üí∞ MONI</h1>
        
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('home')">üè† –ì–æ–ª–æ–≤–Ω–∞</button>
            <button class="nav-tab" onclick="switchTab('analytics')">üìä –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</button>
        </div>

        <!-- –ì–æ–ª–æ–≤–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ -->
        <div id="homeTab">
            <div class="card">
                <div class="top-right-buttons">
                    <button class="btn-secondary" onclick="loadTransactions()" title="–û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ">‚ü≥ –û–Ω–æ–≤–∏—Ç–∏</button>
                </div>
                
                <form id="transactionForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>–î–∞—Ç–∞</label>
                            <input type="date" id="date" required>
                        </div>
                        <div class="form-group">
                            <label>–¢–∏–ø</label>
                            <select id="type">
                                <option value="income">–î–æ—Ö—ñ–¥</option>
                                <option value="expense" selected>–í–∏—Ç—Ä–∞—Ç–∞</option>
                                <option value="exchange">–û–±–º—ñ–Ω</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–°—É–º–∞</label>
                            <input type="number" id="amount" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>–í–∞–ª—é—Ç–∞</label>
                            <select id="currency">
                                <option value="PLN" selected>PLN</option>
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–º–µ–Ω—Ç–∞—Ä</label>
                            <input type="text" id="comment" placeholder="–û–ø–∏—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó">
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button type="submit">–î–æ–¥–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é</button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="month-nav">
                <button onclick="changeMonth(-1)">‚Üê –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π</button>
                <div class="month-title" id="monthTitle"></div>
                <button onclick="changeMonth(1)">–ù–∞—Å—Ç—É–ø–Ω–∏–π ‚Üí</button>
            </div>

            <div id="forecastSection"></div>

            <div class="card">
                <h2 style="margin-bottom: 16px;">–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</h2>
                <div id="transactions"></div>
                
                <div class="summary">
                    <div class="summary-item">
                        <div class="summary-label">üí∞ –î–æ—Ö–æ–¥–∏</div>
                        <div class="summary-value income" id="totalIncome">$0</div>
                        <div id="incomeTrend"></div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">üí∏ –í–∏—Ç—Ä–∞—Ç–∏</div>
                        <div class="summary-value expense" id="totalExpense">$0</div>
                        <div id="expenseTrend"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –≤–∫–ª–∞–¥–∫–∞ -->
        <div id="analyticsTab" class="hidden">
            <div class="analytics-grid" id="analyticsCards"></div>
            <div class="chart-container" id="chartContainer"></div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Supabase
        const SUPABASE_URL = 'https://jukjzojpxmbjcageuucp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1a2p6b2pweG1iamNhZ2V1dWNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2MTAxODcsImV4cCI6MjA4MDE4NjE4N30.0d8KNO6QT7DQ3bAp190jlsSxNvwyUaPrse7CnYIrV_w';

        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // –ú–£–õ–¨–¢–ò–ú–û–í–ê –°–ò–°–¢–ï–ú–ê
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const translations = {
            uk: {
                // Auth
                appName: "MONI",
                appTagline: "–†–æ–∑—É–º–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ñ—ñ–Ω–∞–Ω—Å–∞–º–∏",
                login: "–£–≤—ñ–π—Ç–∏",
                signup: "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å",
                loginTitle: "–£–≤—ñ–π–¥—ñ—Ç—å —â–æ–± –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏",
                signupTitle: "–°—Ç–≤–æ—Ä—ñ—Ç—å –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å",
                forgotPassword: "–ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?",
                forgotPasswordTitle: "–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—é",
                forgotPasswordDesc: "–í–≤–µ–¥—ñ—Ç—å email –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è",
                noAccount: "–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É?",
                haveAccount: "–í–∂–µ —î –∞–∫–∞—É–Ω—Ç?",
                email: "Email",
                password: "–ü–∞—Ä–æ–ª—å",
                passwordMin: "–ü–∞—Ä–æ–ª—å (–º—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤)",
                sendLink: "–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è",
                backToLogin: "‚Üê –ù–∞–∑–∞–¥ –¥–æ –≤—Ö–æ–¥—É",
                
                // Menu
                darkTheme: "–¢–µ–º–Ω–∞ —Ç–µ–º–∞",
                exportCSV: "–ï–∫—Å–ø–æ—Ä—Ç CSV",
                logout: "–í–∏—Ö—ñ–¥",
                language: "–ú–æ–≤–∞",
                
                // Main
                home: "–ì–æ–ª–æ–≤–Ω–∞",
                analytics: "–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞",
                date: "–î–∞—Ç–∞",
                type: "–¢–∏–ø",
                amount: "–°—É–º–∞",
                currency: "–í–∞–ª—é—Ç–∞",
                comment: "–ö–æ–º–µ–Ω—Ç–∞—Ä",
                addTransaction: "–î–æ–¥–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é",
                updateTransaction: "–û–Ω–æ–≤–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é",
                income: "–î–æ—Ö—ñ–¥",
                expense: "–í–∏—Ç—Ä–∞—Ç–∞",
                transactionDesc: "–û–ø–∏—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó",
                
                // Buttons
                previous: "–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π",
                next: "–ù–∞—Å—Ç—É–ø–Ω–∏–π",
                refresh: "–û–Ω–æ–≤–∏—Ç–∏",
                
                // Table
                transactions: "–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó",
                noTransactions: "–ù–µ–º–∞—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∑–∞ —Ü–µ–π –º—ñ—Å—è—Ü—å",
                
                // Summary
                incomeLabel: "üí∞ –î–æ—Ö–æ–¥–∏",
                expenseLabel: "üí∏ –í–∏—Ç—Ä–∞—Ç–∏",
                noChange: "–ë–µ–∑ –∑–º—ñ–Ω",
                
                // Months
                months: ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å',
                        '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å']
            },
            ru: {
                // Auth
                appName: "MONI",
                appTagline: "–£–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏",
                login: "–í–æ–π—Ç–∏",
                signup: "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è",
                loginTitle: "–í–æ–π–¥–∏—Ç–µ —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å",
                signupTitle: "–°–æ–∑–¥–∞–π—Ç–µ —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å",
                forgotPassword: "–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?",
                forgotPasswordTitle: "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è",
                forgotPasswordDesc: "–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏",
                noAccount: "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?",
                haveAccount: "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?",
                email: "Email",
                password: "–ü–∞—Ä–æ–ª—å",
                passwordMin: "–ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)",
                sendLink: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É",
                backToLogin: "‚Üê –ù–∞–∑–∞–¥ –∫–æ –≤—Ö–æ–¥—É",
                
                // Menu
                darkTheme: "–¢–µ–º–Ω–∞—è —Ç–µ–º–∞",
                exportCSV: "–≠–∫—Å–ø–æ—Ä—Ç CSV",
                logout: "–í—ã—Ö–æ–¥",
                language: "–Ø–∑—ã–∫",
                
                // Main
                home: "–ì–ª–∞–≤–Ω–∞—è",
                analytics: "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
                date: "–î–∞—Ç–∞",
                type: "–¢–∏–ø",
                amount: "–°—É–º–º–∞",
                currency: "–í–∞–ª—é—Ç–∞",
                comment: "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
                addTransaction: "–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é",
                updateTransaction: "–û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é",
                income: "–î–æ—Ö–æ–¥",
                expense: "–†–∞—Å—Ö–æ–¥",
                transactionDesc: "–û–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏",
                
                // Buttons
                previous: "–ü—Ä–µ–¥—ã–¥—É—â–∏–π",
                next: "–°–ª–µ–¥—É—é—â–∏–π",
                refresh: "–û–±–Ω–æ–≤–∏—Ç—å",
                
                // Table
                transactions: "–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏",
                noTransactions: "–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü",
                
                // Summary
                incomeLabel: "üí∞ –î–æ—Ö–æ–¥—ã",
                expenseLabel: "üí∏ –†–∞—Å—Ö–æ–¥—ã",
                noChange: "–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π",
                
                // Months
                months: ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                        '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å']
            },
            en: {
                // Auth
                appName: "MONI",
                appTagline: "Smart finance management",
                login: "Login",
                signup: "Sign up",
                loginTitle: "Login to continue",
                signupTitle: "Create an account",
                forgotPassword: "Forgot password?",
                forgotPasswordTitle: "Password recovery",
                forgotPasswordDesc: "Enter email to receive a link",
                noAccount: "No account?",
                haveAccount: "Already have an account?",
                email: "Email",
                password: "Password",
                passwordMin: "Password (minimum 6 characters)",
                sendLink: "Send link",
                backToLogin: "‚Üê Back to login",
                
                // Menu
                darkTheme: "Dark theme",
                exportCSV: "Export CSV",
                logout: "Logout",
                language: "Language",
                
                // Main
                home: "Home",
                analytics: "Analytics",
                date: "Date",
                type: "Type",
                amount: "Amount",
                currency: "Currency",
                comment: "Comment",
                addTransaction: "Add transaction",
                updateTransaction: "Update transaction",
                income: "Income",
                expense: "Expense",
                transactionDesc: "Transaction description",
                
                // Buttons
                previous: "Previous",
                next: "Next",
                refresh: "Refresh",
                
                // Table
                transactions: "Transactions",
                noTransactions: "No transactions for this month",
                
                // Summary
                incomeLabel: "üí∞ Income",
                expenseLabel: "üí∏ Expenses",
                noChange: "No change",
                
                // Months
                months: ['January', 'February', 'March', 'April', 'May', 'June',
                        'July', 'August', 'September', 'October', 'November', 'December']
            }
        };

        let currentLang = localStorage.getItem('language') || 'uk';

        function t(key) {
            return translations[currentLang][key] || key;
        }

        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            updateUI();
            toggleUserMenu(); // Close dropdown
        }

        function updateUI() {
            // –û–Ω–æ–≤–ª—é—î–º–æ –≤—Å—ñ —Ç–µ–∫—Å—Ç–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
            // –¶–µ –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏—Å—è –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ –º–æ–≤–∏
            location.reload(); // –ü—Ä–æ—Å—Ç–∏–π —Å–ø–æ—Å—ñ–± - –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É
        }
        
        let currentUser = null;
        let allTransactions = [];
        let currentMonth = new Date();
        const monthNames = ['–°—ñ—á–µ–Ω—å', '–õ—é—Ç–∏–π', '–ë–µ—Ä–µ–∑–µ–Ω—å', '–ö–≤—ñ—Ç–µ–Ω—å', '–¢—Ä–∞–≤–µ–Ω—å', '–ß–µ—Ä–≤–µ–Ω—å',
                          '–õ–∏–ø–µ–Ω—å', '–°–µ—Ä–ø–µ–Ω—å', '–í–µ—Ä–µ—Å–µ–Ω—å', '–ñ–æ–≤—Ç–µ–Ω—å', '–õ–∏—Å—Ç–æ–ø–∞–¥', '–ì—Ä—É–¥–µ–Ω—å'];

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // AUTH FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        async function checkAuth() {
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —î hash –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ (email confirmation)
            const hashParams = new URLSearchParams(window.location.hash.substring(1));
            if (hashParams.get('access_token')) {
                // Email –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ, Supabase –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ª–æ–≥—ñ–Ω–∏—Ç—å
                showToast('Email –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ! –í—ñ—Ç–∞—î–º–æ! üéâ', 'success');
                // –û—á–∏—â–∞—î–º–æ hash –∑ URL
                window.history.replaceState(null, '', window.location.pathname);
            }
            
            const { data: { session } } = await supabaseClient.auth.getSession();
            
            if (session) {
                currentUser = session.user;
                showApp();
                await loadTransactions();
            } else {
                showAuth();
            }
        }

        function showApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('userEmail').textContent = currentUser.email;
            initializeForm();
        }

        function showAuth() {
            document.getElementById('authContainer').style.display = 'block';
            document.getElementById('appContainer').style.display = 'none';
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –º—ñ–∂ —Ñ–æ—Ä–º–∞–º–∏
        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            clearAuthMessages();
        }

        function showSignup() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'block';
            document.getElementById('forgotPasswordForm').style.display = 'none';
            clearAuthMessages();
        }

        function showForgotPassword() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('signupForm').style.display = 'none';
            document.getElementById('forgotPasswordForm').style.display = 'block';
            clearAuthMessages();
        }

        function clearAuthMessages() {
            document.getElementById('authError').style.display = 'none';
            document.getElementById('signupError').style.display = 'none';
            document.getElementById('forgotError').style.display = 'none';
            document.getElementById('authSuccess').style.display = 'none';
            document.getElementById('signupSuccess').style.display = 'none';
            document.getElementById('forgotSuccess').style.display = 'none';
        }

        function showAuthError(message, formType = 'login') {
            const errorId = formType === 'signup' ? 'signupError' : 
                          formType === 'forgot' ? 'forgotError' : 'authError';
            const errorEl = document.getElementById(errorId);
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        function showAuthSuccess(message, formType = 'login') {
            const successId = formType === 'signup' ? 'signupSuccess' : 
                            formType === 'forgot' ? 'forgotSuccess' : 'authSuccess';
            const successEl = document.getElementById(successId);
            successEl.textContent = message;
            successEl.style.display = 'block';
        }

        // Login
        async function handleLogin(e) {
            e.preventDefault();
            clearAuthMessages();

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const submitBtn = e.target.querySelector('button[type="submit"]');
            setButtonLoading(submitBtn, true);

            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) throw error;

                currentUser = data.user;
                showApp();
                await loadTransactions();
                showToast('–í—ñ—Ç–∞—î–º–æ! –í–∏ —É–≤—ñ–π—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'success');

            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = '–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É. ';
                
                if (error.message.includes('Invalid login credentials')) {
                    errorMessage += '–ù–µ–≤—ñ—Ä–Ω–∏–π email –∞–±–æ –ø–∞—Ä–æ–ª—å.';
                } else if (error.message.includes('Email not confirmed')) {
                    errorMessage += '–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å email –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º.';
                } else {
                    errorMessage += error.message;
                }
                
                showAuthError(errorMessage, 'login');
            } finally {
                setButtonLoading(submitBtn, false);
            }
        }

        // Signup
        async function handleSignup(e) {
            e.preventDefault();
            clearAuthMessages();

            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            const submitBtn = e.target.querySelector('button[type="submit"]');
            setButtonLoading(submitBtn, true);

            try {
                const { data, error } = await supabaseClient.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        emailRedirectTo: window.location.origin
                    }
                });

                if (error) throw error;

                showAuthSuccess('–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞! –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ email –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è.', 'signup');
                
                // –û—á–∏—â—É—î–º–æ —Ñ–æ—Ä–º—É
                document.getElementById('signupEmail').value = '';
                document.getElementById('signupPassword').value = '';

            } catch (error) {
                console.error('Signup error:', error);
                let errorMessage = '–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó. ';
                
                if (error.message.includes('already registered')) {
                    errorMessage += '–¶–µ–π email –≤–∂–µ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ.';
                } else {
                    errorMessage += error.message;
                }
                
                showAuthError(errorMessage, 'signup');
            } finally {
                setButtonLoading(submitBtn, false);
            }
        }

        // Forgot Password
        async function handleForgotPassword(e) {
            e.preventDefault();
            clearAuthMessages();

            const email = document.getElementById('forgotEmail').value;

            const submitBtn = e.target.querySelector('button[type="submit"]');
            setButtonLoading(submitBtn, true);

            try {
                const { error } = await supabaseClient.auth.resetPasswordForEmail(email, {
                    redirectTo: window.location.origin
                });

                if (error) throw error;

                showAuthSuccess('–ü–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—é –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –Ω–∞ email!', 'forgot');
                document.getElementById('forgotEmail').value = '';

            } catch (error) {
                console.error('Forgot password error:', error);
                showAuthError('–ü–æ–º–∏–ª–∫–∞: ' + error.message, 'forgot');
            } finally {
                setButtonLoading(submitBtn, false);
            }
        }

        // Google Login
        async function loginWithGoogle() {
            try {
                const { error } = await supabaseClient.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin
                    }
                });

                if (error) throw error;

            } catch (error) {
                console.error('Google login error:', error);
                showAuthError('–ü–æ–º–∏–ª–∫–∞ –≤—Ö–æ–¥—É —á–µ—Ä–µ–∑ Google: ' + error.message);
            }
        }

        // Logout
        async function handleLogout() {
            try {
                const { error } = await supabaseClient.auth.signOut();
                if (error) throw error;

                currentUser = null;
                showAuth();
                showLogin();
                showToast('–í–∏ –≤–∏–π—à–ª–∏ –∑ —Å–∏—Å—Ç–µ–º–∏', 'success');

            } catch (error) {
                console.error('Logout error:', error);
                showToast('–ü–æ–º–∏–ª–∫–∞ –≤–∏—Ö–æ–¥—É: ' + error.message, 'error');
            }
        }

        // –°–ª—É—Ö–∞—á –∑–º—ñ–Ω–∏ auth —Å—Ç–∞–Ω—É
        supabaseClient.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session) {
                currentUser = session.user;
                showApp();
                loadTransactions();
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                showAuth();
            }
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // EXISTING APP FUNCTIONS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Ñ–æ—Ä–º–∏ (–≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –≤—Ö–æ–¥—É)
        function initializeForm() {
            const dateInput = document.getElementById('date');
            if (dateInput) {
                dateInput.valueAsDate = new Date();
            }
            updateMonthTitle();
        }

        // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tab) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'home') {
                document.getElementById('homeTab').classList.remove('hidden');
                document.getElementById('analyticsTab').classList.add('hidden');
            } else {
                document.getElementById('homeTab').classList.add('hidden');
                document.getElementById('analyticsTab').classList.remove('hidden');
                renderAnalytics();
            }
        }

        // –ó–º—ñ–Ω–∞ –º—ñ—Å—è—Ü—è
        function changeMonth(delta) {
            currentMonth.setMonth(currentMonth.getMonth() + delta);
            updateMonthTitle();
            displayCurrentMonth();
        }

        function updateMonthTitle() {
            document.getElementById('monthTitle').textContent = 
                `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
        async function loadTransactions() {
            try {
                // RLS –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ñ—ñ–ª—å—Ç—Ä—É—î –ø–æ user_id
                const { data, error } = await supabaseClient
                    .from('transactions')
                    .select('*')
                    .order('date', { ascending: true });

                if (error) throw error;

                allTransactions = data || [];
                displayCurrentMonth();
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', error);
                showToast('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è: ' + error.message, 'error');
            }
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –ø–æ—Ç–æ—á–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è
        function displayCurrentMonth() {
            const monthTransactions = allTransactions.filter(t => {
                const tDate = new Date(t.date);
                return tDate.getMonth() === currentMonth.getMonth() && 
                       tDate.getFullYear() === currentMonth.getFullYear();
            });

            displayTransactions(monthTransactions);
            calculateSummary(monthTransactions);
            displayForecast();
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
        function displayTransactions(transactions) {
            const container = document.getElementById('transactions');
            
            if (transactions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6e6e73; padding: 20px;">–ù–µ–º–∞—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∑–∞ —Ü–µ–π –º—ñ—Å—è—Ü—å</p>';
                return;
            }

            const html = `
                <table>
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–¢–∏–ø</th>
                            <th>–°—É–º–∞</th>
                            <th>USD</th>
                            <th>–ö–æ–º–µ–Ω—Ç–∞—Ä</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${transactions.map(t => `
                            <tr class="${t.type}">
                                <td data-label="–î–∞—Ç–∞:">${new Date(t.date).toLocaleDateString('uk-UA')}</td>
                                <td data-label="–¢–∏–ø:">${t.type === 'income' ? '–î–æ—Ö—ñ–¥' : t.type === 'expense' ? '–í–∏—Ç—Ä–∞—Ç–∞' : '–û–±–º—ñ–Ω'}</td>
                                <td data-label="–°—É–º–∞:" class="tooltip">
                                    ${Math.round(t.amount)} ${t.currency}
                                    <span class="tooltiptext">–ö—É—Ä—Å: 1 ${t.currency} = $${t.rate.toFixed(4)}</span>
                                </td>
                                <td data-label="USD:">$${Math.round(t.usd_amount)}</td>
                                <td data-label="–ö–æ–º–µ–Ω—Ç–∞—Ä:" style="position: relative;">
                                    ${t.comment || ''}
                                    <div class="row-actions">
                                        <button class="icon-btn" onclick="editTransaction(${t.id})" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">‚úèÔ∏è</button>
                                        <button class="icon-btn delete" onclick="deleteTransaction(${t.id})" title="–í–∏–¥–∞–ª–∏—Ç–∏">üóëÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = html;
        }

        // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø—ñ–¥—Å—É–º–∫—ñ–≤
        function calculateSummary(transactions) {
            const income = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.usd_amount, 0);
            
            const expense = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.usd_amount, 0);

            // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –º—ñ—Å—è—Ü—è –¥–ª—è trends
            const prevMonth = new Date(currentMonth);
            prevMonth.setMonth(prevMonth.getMonth() - 1);
            const prevMonthTransactions = allTransactions.filter(t => {
                const tDate = new Date(t.date);
                return tDate.getMonth() === prevMonth.getMonth() && 
                       tDate.getFullYear() === prevMonth.getFullYear();
            });

            const prevIncome = prevMonthTransactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.usd_amount, 0);
            
            const prevExpense = prevMonthTransactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.usd_amount, 0);

            // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∑–º—ñ–Ω
            const incomeChange = prevIncome > 0 ? ((income - prevIncome) / prevIncome * 100) : 0;
            const expenseChange = prevExpense > 0 ? ((expense - prevExpense) / prevExpense * 100) : 0;

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
            document.getElementById('totalIncome').textContent = '$' + Math.round(income);
            document.getElementById('totalExpense').textContent = '$' + Math.round(expense);

            // –î–æ–¥–∞—î–º–æ trend indicators
            updateTrendIndicator('incomeTrend', incomeChange, true);
            updateTrendIndicator('expenseTrend', expenseChange, false);
        }

        function updateTrendIndicator(elementId, change, isIncomeGood) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const absChange = Math.abs(change);
            let trendClass = 'neutral';
            let arrow = '‚Äî';

            if (change > 0) {
                arrow = '‚Üë';
                trendClass = isIncomeGood ? 'positive' : 'negative';
            } else if (change < 0) {
                arrow = '‚Üì';
                trendClass = isIncomeGood ? 'negative' : 'positive';
            }

            if (absChange > 0) {
                element.innerHTML = `<span class="trend-indicator ${trendClass}">${arrow} ${absChange.toFixed(0)}%</span>`;
            } else {
                element.innerHTML = '<span class="trend-indicator neutral">‚Äî –ë–µ–∑ –∑–º—ñ–Ω</span>';
            }
        }

        // –ü—Ä–æ–≥–Ω–æ–∑ –≤–∏—Ç—Ä–∞—Ç
        function displayForecast() {
            const now = new Date();
            const forecastSection = document.getElementById('forecastSection');
            
            if (currentMonth <= now) {
                forecastSection.innerHTML = '';
                return;
            }

            // –ê–Ω–∞–ª—ñ–∑ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 3 –º—ñ—Å—è—Ü—ñ–≤
            const last3Months = [];
            for (let i = 1; i <= 3; i++) {
                const month = new Date(currentMonth);
                month.setMonth(month.getMonth() - i);
                last3Months.push(month);
            }

            const expensesByComment = {};
            
            last3Months.forEach(month => {
                const monthExpenses = allTransactions.filter(t => {
                    const tDate = new Date(t.date);
                    return t.type === 'expense' && 
                           tDate.getMonth() === month.getMonth() && 
                           tDate.getFullYear() === month.getFullYear();
                });
                
                monthExpenses.forEach(expense => {
                    const comment = (expense.comment || '').toLowerCase().trim();
                    if (!comment) return;
                    
                    if (!expensesByComment[comment]) {
                        expensesByComment[comment] = {
                            amounts: [],
                            originalComment: expense.comment
                        };
                    }
                    
                    expensesByComment[comment].amounts.push(expense.usd_amount);
                });
            });

            const regularExpenses = [];
            for (let comment in expensesByComment) {
                const data = expensesByComment[comment];
                if (data.amounts.length === 3) {
                    const avgAmount = data.amounts.reduce((a, b) => a + b, 0) / data.amounts.length;
                    regularExpenses.push({
                        comment: data.originalComment,
                        amount: avgAmount
                    });
                }
            }

            if (regularExpenses.length === 0) {
                forecastSection.innerHTML = '';
                return;
            }

            const totalForecast = regularExpenses.reduce((sum, item) => sum + item.amount, 0);

            forecastSection.innerHTML = `
                <div class="forecast-section">
                    <div class="forecast-title">üîÆ –ü—Ä–æ–≥–Ω–æ–∑ –≤–∏—Ç—Ä–∞—Ç –Ω–∞ –æ—Å–Ω–æ–≤—ñ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö 3 –º—ñ—Å—è—Ü—ñ–≤</div>
                    ${regularExpenses.map(item => `
                        <div class="forecast-item">
                            <span>${item.comment}</span>
                            <strong>$${Math.round(item.amount)}</strong>
                        </div>
                    `).join('')}
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #ff9500; display: flex; justify-content: space-between; font-weight: 600; font-size: 16px;">
                        <span>–ó–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑:</span>
                        <span>$${Math.round(totalForecast)}</span>
                    </div>
                    <button onclick="createFromForecast(${JSON.stringify(regularExpenses).replace(/"/g, '&quot;')})" style="margin-top: 16px;">
                        –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –∑ –ø—Ä–æ–≥–Ω–æ–∑—É
                    </button>
                </div>
            `;
        }

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –∑ –ø—Ä–æ–≥–Ω–æ–∑—É
        async function createFromForecast(forecast) {
            try {
                showStatus('–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π...', 'success');
                
                const currentDateStr = currentMonth.toISOString().split('T')[0].substring(0, 7) + '-01';
                
                const newTransactions = [];
                for (let item of forecast) {
                    const rate = await getExchangeRate('USD');
                    
                    newTransactions.push({
                        date: currentDateStr,
                        type: 'expense',
                        amount: item.amount,
                        currency: 'USD',
                        comment: item.comment,
                        usd_amount: item.amount,
                        rate: rate
                    });
                }
                
                const { error } = await supabaseClient
                    .from('transactions')
                    .insert(newTransactions);

                if (error) throw error;

                showStatus('‚úì –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó —Å—Ç–≤–æ—Ä–µ–Ω–æ!', 'success');
                loadTransactions();
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                showStatus('‚úï –ü–æ–º–∏–ª–∫–∞: ' + error.message, 'error');
            }
        }

        // –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
        document.getElementById('transactionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('button[type="submit"]');
            
            try {
                setButtonLoading(submitBtn, true);
                
                const date = document.getElementById('date').value;
                const type = document.getElementById('type').value;
                const amount = parseFloat(document.getElementById('amount').value);
                const currency = document.getElementById('currency').value;
                const comment = document.getElementById('comment').value;

                const rate = await getExchangeRate(currency);
                const usdAmount = amount * rate;

                const transactionData = {
                    date: date,
                    type: type,
                    amount: amount,
                    currency: currency,
                    comment: comment,
                    usd_amount: usdAmount,
                    rate: rate,
                    user_id: currentUser.id  // –î–æ–¥–∞—î–º–æ user_id
                };

                let error;
                
                if (editingTransactionId) {
                    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å–Ω—É—é—á–æ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
                    const result = await supabaseClient
                        .from('transactions')
                        .update(transactionData)
                        .eq('id', editingTransactionId)
                        .eq('user_id', currentUser.id);  // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–µ–∑–ø–µ–∫–∏
                    error = result.error;
                    
                    if (!error) {
                        showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
                    }
                    
                    cancelEdit();
                } else {
                    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
                    const result = await supabaseClient
                        .from('transactions')
                        .insert([transactionData])
                        .select();
                    error = result.error;
                    
                    if (!error) {
                        showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –¥–æ–¥–∞–Ω–∞!', 'success');
                    }
                }

                if (error) throw error;

                document.getElementById('amount').value = '';
                document.getElementById('comment').value = '';
                
                await loadTransactions();
                
                // Smooth scroll –¥–æ —Ç–∞–±–ª–∏—Ü—ñ
                setTimeout(() => {
                    const table = document.querySelector('table');
                    if (table) {
                        table.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                }, 100);
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                showToast('–ü–æ–º–∏–ª–∫–∞: ' + error.message, 'error');
            } finally {
                setButtonLoading(submitBtn, false);
            }
        });

        // –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
        async function deleteTransaction(id) {
            if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é?')) return;
            
            try {
                const { error } = await supabaseClient
                    .from('transactions')
                    .delete()
                    .eq('id', id)
                    .eq('user_id', currentUser.id);  // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–µ–∑–ø–µ–∫–∏

                if (error) throw error;

                showToast('–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤–∏–¥–∞–ª–µ–Ω–∞', 'success');
                loadTransactions();
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                showToast('–ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è: ' + error.message, 'error');
            }
        }

        // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó (–∑–∞–ø–æ–≤–Ω—é—î —Ñ–æ—Ä–º—É)
        let editingTransactionId = null;

        function editTransaction(id) {
            const transaction = allTransactions.find(t => t.id === id);
            if (!transaction) return;
            
            editingTransactionId = id;
            
            document.getElementById('date').value = transaction.date;
            document.getElementById('type').value = transaction.type;
            document.getElementById('amount').value = transaction.amount;
            document.getElementById('currency').value = transaction.currency;
            document.getElementById('comment').value = transaction.comment || '';
            
            // –ú—ñ–Ω—è—î–º–æ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
            const submitBtn = document.querySelector('#transactionForm button[type="submit"]');
            submitBtn.textContent = '–û–Ω–æ–≤–∏—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é';
            submitBtn.style.background = '#ff9500';
            
            // –ü—Ä–æ–∫—Ä—É—á—É—î–º–æ –¥–æ —Ñ–æ—Ä–º–∏
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            showToast('–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó', 'success');
        }

        function cancelEdit() {
            editingTransactionId = null;
            const submitBtn = document.querySelector('#transactionForm button[type="submit"]');
            submitBtn.textContent = '–î–æ–¥–∞—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é';
            submitBtn.style.background = '';
            document.getElementById('amount').value = '';
            document.getElementById('comment').value = '';
        }

        // –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞
        function renderAnalytics() {
            const currentSummary = getSummaryForMonth(currentMonth);
            
            const prevMonth = new Date(currentMonth);
            prevMonth.setMonth(prevMonth.getMonth() - 1);
            const prevSummary = getSummaryForMonth(prevMonth);

            const allMonths = {};
            allTransactions.forEach(t => {
                const date = new Date(t.date);
                const key = `${date.getFullYear()}-${date.getMonth()}`;
                if (!allMonths[key]) {
                    allMonths[key] = { income: 0, expense: 0 };
                }
                if (t.type === 'income') allMonths[key].income += t.usd_amount;
                if (t.type === 'expense') allMonths[key].expense += t.usd_amount;
            });

            const monthCount = Object.keys(allMonths).length || 1;
            const totalIncome = Object.values(allMonths).reduce((sum, m) => sum + m.income, 0);
            const totalExpense = Object.values(allMonths).reduce((sum, m) => sum + m.expense, 0);

            const avgIncome = totalIncome / monthCount;
            const avgExpense = totalExpense / monthCount;

            const incomeChange = prevSummary.income > 0 
                ? ((currentSummary.income - prevSummary.income) / prevSummary.income * 100)
                : 0;
            const expenseChange = prevSummary.expense > 0
                ? ((currentSummary.expense - prevSummary.expense) / prevSummary.expense * 100)
                : 0;

            document.getElementById('analyticsCards').innerHTML = `
                <div class="stat-card">
                    <div class="stat-title">–î–æ—Ö–æ–¥–∏ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è</div>
                    <div class="stat-value" style="color: #34c759;">$${Math.round(currentSummary.income)}</div>
                    <div class="stat-comparison ${incomeChange >= 0 ? 'positive' : 'negative'}">
                        ${incomeChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(incomeChange).toFixed(1)}% –≤—ñ–¥ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">–í–∏—Ç—Ä–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è</div>
                    <div class="stat-value" style="color: #ff9500;">$${Math.round(currentSummary.expense)}</div>
                    <div class="stat-comparison ${expenseChange <= 0 ? 'positive' : 'negative'}">
                        ${expenseChange >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(expenseChange).toFixed(1)}% –≤—ñ–¥ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">–°–µ—Ä–µ–¥–Ω—ñ –¥–æ—Ö–æ–¥–∏</div>
                    <div class="stat-value" style="color: #34c759;">$${Math.round(avgIncome)}</div>
                    <div style="font-size: 14px; color: #6e6e73;">–ó–∞ –≤—Å—é —ñ—Å—Ç–æ—Ä—ñ—é</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">–°–µ—Ä–µ–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏</div>
                    <div class="stat-value" style="color: #ff9500;">$${Math.round(avgExpense)}</div>
                    <div style="font-size: 14px; color: #6e6e73;">–ó–∞ –≤—Å—é —ñ—Å—Ç–æ—Ä—ñ—é</div>
                </div>
            `;

            renderChart();
        }

        function getSummaryForMonth(month) {
            const monthTransactions = allTransactions.filter(t => {
                const tDate = new Date(t.date);
                return tDate.getMonth() === month.getMonth() && 
                       tDate.getFullYear() === month.getFullYear();
            });

            return {
                income: monthTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.usd_amount, 0),
                expense: monthTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.usd_amount, 0)
            };
        }

        function renderChart() {
            const chartData = [];
            for (let i = 5; i >= 0; i--) {
                const month = new Date();
                month.setMonth(month.getMonth() - i);
                const summary = getSummaryForMonth(month);
                chartData.push({
                    month: month,
                    income: summary.income,
                    expense: summary.expense
                });
            }

            const maxValue = Math.max(...chartData.map(d => Math.max(d.income, d.expense))) || 1;

            document.getElementById('chartContainer').innerHTML = `
                <div class="chart-title">–î–æ—Ö–æ–¥–∏ —Ç–∞ –≤–∏—Ç—Ä–∞—Ç–∏ –ø–æ –º—ñ—Å—è—Ü—è—Ö</div>
                <div class="bar-chart">
                    ${chartData.map(data => `
                        <div class="bar-group">
                            <div class="bars">
                                <div class="bar income-bar" style="height: ${(data.income / maxValue) * 100}%">
                                    ${data.income > 0 ? `<div class="bar-value" style="color: #34c759;">$${data.income.toFixed(0)}</div>` : ''}
                                </div>
                                <div class="bar expense-bar" style="height: ${(data.expense / maxValue) * 100}%">
                                    ${data.expense > 0 ? `<div class="bar-value" style="color: #ff9500;">$${data.expense.toFixed(0)}</div>` : ''}
                                </div>
                            </div>
                            <div class="bar-label">${monthNames[data.month.getMonth()].substring(0, 3)}</div>
                        </div>
                    `).join('')}
                </div>
                <div style="display: flex; justify-content: center; gap: 20px; margin-top: 20px; font-size: 14px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 16px; height: 16px; background: #34c759; border-radius: 4px;"></div>
                        <span>–î–æ—Ö–æ–¥–∏</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 16px; height: 16px; background: #ff9500; border-radius: 4px;"></div>
                        <span>–í–∏—Ç—Ä–∞—Ç–∏</span>
                    </div>
                </div>
            `;
        }

        // –ï–∫—Å–ø–æ—Ä—Ç –≤ CSV
        function exportToCSV() {
            const headers = ['date', 'type', 'amount', 'currency', 'comment', 'usd_amount', 'rate'];
            const csvRows = [headers.join(',')];
            
            allTransactions.forEach(t => {
                const row = [
                    t.date,
                    t.type,
                    t.amount,
                    t.currency,
                    `"${(t.comment || '').replace(/"/g, '""')}"`,
                    t.usd_amount,
                    t.rate
                ];
                csvRows.push(row.join(','));
            });
            
            const csvContent = csvRows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `expense-tracker-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫—É—Ä—Å—É –≤–∞–ª—é—Ç–∏
        async function getExchangeRate(currency) {
            if (currency === 'USD') return 1;
            
            try {
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
                const data = await response.json();
                
                const rates = {
                    'PLN': data.rates.PLN,
                    'EUR': data.rates.EUR
                };
                
                return 1 / rates[currency];
            } catch (error) {
                console.warn('–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é –∑–∞–ø–∞—Å–Ω—ñ –∫—É—Ä—Å–∏');
                return currency === 'PLN' ? 0.25 : 1.08;
            }
        }

        // Toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = type === 'success' ? '‚úì' : '‚úï';
            
            toast.innerHTML = `
                <div class="toast-icon">${icon}</div>
                <div class="toast-message">${message}</div>
                <button class="toast-close" onclick="hideToast()">√ó</button>
            `;
            
            toast.className = `toast ${type}`;
            
            // Show toast
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Auto hide after 3 seconds
            setTimeout(() => hideToast(), 3000);
        }

        function hideToast() {
            const toast = document.getElementById('toast');
            toast.classList.remove('show');
        }

        // Loading state –¥–ª—è –∫–Ω–æ–ø–∫–∏
        function setButtonLoading(button, isLoading) {
            if (isLoading) {
                button.classList.add('loading');
                button.disabled = true;
            } else {
                button.classList.remove('loading');
                button.disabled = false;
            }
        }

        // –ü–æ–∫–∞–∑ —Å—Ç–∞—Ä–æ–≥–æ —Å—Ç–∞—Ç—É—Å—É (–¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ)
        function showStatus(message, type) {
            showToast(message, type);
        }

        // Dark Mode Toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            const icon = document.getElementById('themeIcon');
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            if (icon) icon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function toggleThemeFromDropdown() {
            toggleTheme();
            // –ù–µ –∑–∞–∫—Ä–∏–≤–∞—î–º–æ dropdown –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—ñ —Ç–µ–º–∏
        }

        function toggleUserMenu() {
            document.getElementById('userMenu').classList.toggle('active');
        }

        // –ó–∞–∫—Ä–∏—Ç—Ç—è dropdown –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
        document.addEventListener('click', (e) => {
            const menu = document.getElementById('userMenu');
            if (menu && !menu.contains(e.target)) {
                menu.classList.remove('active');
            }
        });

        function exportCSV() {
            if (allTransactions.length === 0) {
                showToast('–ù–µ–º–∞—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É', 'error');
                toggleUserMenu();
                return;
            }
            
            const headers = ['–î–∞—Ç–∞', '–¢–∏–ø', '–°—É–º–∞', '–í–∞–ª—é—Ç–∞', 'USD', '–ö–æ–º–µ–Ω—Ç–∞—Ä'];
            const rows = allTransactions.map(t => [
                t.date,
                t.type === 'income' ? '–î–æ—Ö—ñ–¥' : '–í–∏—Ç—Ä–∞—Ç–∞',
                t.amount,
                t.currency,
                t.usd_amount.toFixed(2),
                t.comment || ''
            ]);
            
            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');
            
            const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const date = new Date().toISOString().split('T')[0];
            link.href = URL.createObjectURL(blob);
            link.download = `moni-export-${date}.csv`;
            link.click();
            
            showToast('CSV –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ —É—Å–ø—ñ—à–Ω–æ!', 'success');
            toggleUserMenu();
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ—ó —Ç–µ–º–∏
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const icon = document.getElementById('themeIcon');
            
            document.documentElement.setAttribute('data-theme', savedTheme);
            if (icon) icon.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
        loadTheme();
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–æ–≤–∏
        const savedLang = localStorage.getItem('language') || 'uk';
        currentLang = savedLang;
        const langSelect = document.getElementById('languageSelect');
        if (langSelect) langSelect.value = savedLang;
        
        checkAuth(); // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π
    </script>
</body>
</html>
